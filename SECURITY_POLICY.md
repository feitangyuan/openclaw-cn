# OpenClaw-CN 安全规范（飞书场景）

本规范用于 `openclaw-cn` 一键部署后的默认安全边界，目标是：可用、可控、可追责。

## 1. 默认安全基线

- 默认 `dmPolicy=pairing`，禁止默认开放所有私聊来源。
- 未配对用户消息不进入正常处理流程。
- 禁止默认写入 `allowFrom=["*"]`。
- 任何扩权、外发、改配置动作都必须有人确认。

## 2. 人在回路（Human-in-the-loop）

以下动作必须先在飞书中向用户请求明确同意，再执行：

- 开启/关闭通道访问策略（如 `pairing -> open`）。
- 新增或批量修改 `allowFrom`、`groupAllowFrom`。
- 安装新增 skill 或其系统依赖（brew/npm/apt 等）。
- 配置或更换外部 API Key（搜索、第三方平台等）。
- 进行高风险外部操作（批量发送、批量删除、权限变更）。

确认要求：

- 必须给出将执行的具体命令或动作说明。
- 必须等待用户明确回复“同意/确认”后再执行。
- 未确认时仅提供操作指引，不执行。

## 3. 缺配置/缺权限时的处理原则

部署后如触发以下问题，机器人应先提示“缺什么 + 怎么补”，再等待用户操作：

- 缺 API Key（如 web_search 缺 Brave/Moonshot 等）。
- 缺 skill 依赖（二进制、环境变量、配置项）。
- 缺飞书权限（scope 未授权）。

处理要求：

- 优先返回最短可执行命令。
- 不得伪造“已完成”，不得静默降级成高风险模式。
- 若需要管理员操作（飞书权限授权），必须明确说明“需要管理员”。

## 4. 飞书权限最小化

仅开启当前业务必要权限，避免一次性全开。

基础通信（常见最小集）：

- `im:message`
- `im:chat`
- `contact:user.base:readonly`（用于用户信息解析）

文档能力按需开启：

- Doc 读取/写入：`docx:*`（按功能最小化）
- 云盘：`drive:*`（按功能最小化）
- Wiki：`wiki:*`（按功能最小化）
- 权限管理：`drive:permission`（仅在确需共享管理时开启）

## 5. 密钥与配置安全

- App Secret、模型 Key、搜索 Key 仅存本机配置，不入仓库。
- 禁止在日志、截图、Issue、README 中明文暴露密钥。
- 发现泄露应立即轮换并重启网关。

## 6. 审计与排障

建议保留以下检查习惯：

- `openclaw status`
- `openclaw health`
- `openclaw channels list`
- `openclaw skills check`

若用户反馈“不能用”，先判断是：

- 配对未批准；
- API Key 缺失/不匹配；
- 飞书 scope 未授权；
- skill 依赖缺失。

## 7. 默认立场

- 安全优先于便利。
- 不做未授权动作。
- 能提示就提示，不能自动修就给明确下一步命令。
